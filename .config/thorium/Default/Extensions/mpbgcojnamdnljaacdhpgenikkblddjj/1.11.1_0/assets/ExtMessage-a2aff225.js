var M=Object.defineProperty;var L=(o,n,e)=>n in o?M(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e;var v=(o,n,e)=>(L(o,typeof n!="symbol"?n+"":n,e),e);import{o as x}from"./onMessage-fb148085.js";class f{static debug(n,...e){}}const b=[];class S{static send({tabId:n,...e}){return new Promise(u=>{const r=s=>{f.debug("Sent",e.event,s,{...e,tabId:n}),u(s)};return n?chrome.tabs.sendMessage(n,e,r):chrome.runtime.sendMessage(e,r)})}static once(n){const{event:e,external:u,...r}=n,s=u?chrome.runtime.onMessageExternal:chrome.runtime.onMessage;return x({addListener(a){b.push(n),s.addListener(a)},removeListener(a){const t=b.indexOf(n);t!==-1&&b.splice(t,1),s.removeListener(a)},timeout:29e3,...r,once:!0,transform:a=>{if(typeof a=="string")try{return JSON.parse(a)}catch{}return a},filter:(a,t)=>{var l,c;return a.event===e&&(!r.filter||r.filter({...a,tabId:(l=t.tab)==null?void 0:l.id,tabUrl:(c=t.tab)==null?void 0:c.url}))},handler:async(a,t,l)=>{var m,h;const c={...a,tabId:(m=t.tab)==null?void 0:m.id,tabUrl:(h=t.tab)==null?void 0:h.url};return r.handler?((async()=>{var g;const d=await((g=r.handler)==null?void 0:g.call(r,c));f.debug("Once",c.event,{req:c,res:d}),l(u?JSON.stringify(d):d)})(),!0):(f.debug("Once",c.event,{noHandler:!0,req:c}),!1)}})}static addListeners(n,e){(e!=null&&e.external?chrome.runtime.onMessageExternal:chrome.runtime.onMessage).addListener((r,s,a)=>{var d,g;if(typeof r=="string")try{r=JSON.parse(r)}catch{}const t={...r,tabId:(d=s.tab)==null?void 0:d.id,tabUrl:(g=s.tab)==null?void 0:g.url},l=t==null?void 0:t.event;if(b.some(i=>i.event===l&&(!i.filter||i.filter(t)))||!!(e!=null&&e.app)!=!!t.app)return!0;const m=n.filter(i=>i.event===l),h=m.length?m:n.filter(i=>i.event==="*");return Promise.race(h.map(i=>i.handler(t))).then(i=>{f.debug("Replied",t.event,i,{sender:s,req:t}),a(e!=null&&e.external?JSON.stringify(i):i)}),!0})}}class E{constructor(n,e){v(this,"event");v(this,"handler");this.event=n,this.handler=e}}export{S as E,E as a};
