import{s as f}from"./sendWindowMessage-46579fce.js";import{scrape as u}from"./scrape-46237ed9.js";import{E as o}from"./ExtMessage-a2aff225.js";import"./onMessage-fb148085.js";async function E(){var s;g();const r=await p();if(!r)return;const t=(s=await o.send({iFrameId:r,event:"frame:os:ready",data:{href:location.href}}))==null?void 0:s.command;if(!t)return;const n=await o.send({app:!0,event:"content:app:getConfigs"});if(!n)return;const e=n.specs.find(({id:d})=>d===t.site.specId);if(!e)return;const{site:a,type:i,context:c}=t,m=await u({spec:e,siteMeta:a.meta,tags:n.tags,type:i,context:c});o.send({iFrameId:r,event:"frame:os:rawPage",data:{rawPage:m}})}async function p(){return await f({event:"frame:os:getIFrameId",args:void 0,receiverWindow:window.top??void 0,timeout:5e3,targetOrigin:`chrome-extension://${chrome.runtime.id}`})}function g(){document.body.style.setProperty("display","none"),new MutationObserver(t=>{t.forEach(n=>{n.addedNodes.forEach(e=>{var a;(e instanceof HTMLAudioElement||e instanceof HTMLVideoElement||e instanceof HTMLIFrameElement)&&((a=e.parentElement)==null||a.removeChild(e))})})}).observe(document.documentElement,{childList:!0,subtree:!0})}export{E as handleIFrame};
